# Audio Configuration and Testing Library - README

## Overview

This repository contains a collection of shell scripts for audio configuration, optimization, and diagnostics on Android and Linux systems. The scripts are categorized into two main directories:

- **config_scripts/**: Scripts for advanced audio configurations, such as USB hi-fi playback, jitter reduction, and resampling.
- **audio_testing/**: Scripts for testing and gathering detailed information about the audio hardware and configurations.

---

## Repository Structure
### 1. `config_scripts/`
```
config_scripts/
  |— USB_48k_24_offload-hifi-playback.sh # Script for 48kHz/24-bit USB hi-fi playback offload
  |— USB_SampleRate_Changer.sh           # Script to change USB sample rate
  |— change-usb-period.sh                # Adjust USB audio period settings
  |— functions3.shlib                    # Library of functions for audio configuration
  |— jitter-reducer-functions.shlib      # Functions for reducing audio jitter
  |— jitter-reducer.sh                   # Main script to reduce audio jitter
  |— jitterLiteReducer.sh                # Lightweight version of the jitter reducer
  |— jitterReducer.sh                    # General audio jitter reduction script
  |— jitterrestore_sh.sh                 # Restore audio jitter settings
  |— offload-hifi-playback.sh            # Script for hi-fi playback offload
  |— resampling.sh                       # Script for resampling audio configurations
  |— readme.md                           # Documentation file
```

### 2. `audio_testing/`
```
audio_testing/ 
    |— alsa-dac-profile.sh              # Displays hardware/software configuration for ALSA DACs 
    |— audio-conf-src.sh                # Retrieves audio policy configuration details 
    |— audioTestlib.sh                  # Main script to execute all or specific tests 
    |— dmesg-audio.sh                   # Captures audio-related logs from the kernel ring buffer 
    |— dumpsys-audio.sh                 # Captures filtered audio-related dumpsys information 
    |— dumpsys-bt.sh                    # Filters and captures Bluetooth-specific audio details
    |— readme.md                        # Documentation file
```


---

## Features

### Configuration Features (`config_scripts`)
- **Advanced USB Audio Configuration**: Customize USB audio settings, sample rates, and periods.
- **Jitter Reduction**: Optimize audio playback by reducing jitter using modular scripts.
- **Hi-Fi Playback Offloading**: Enable efficient and high-quality playback for hi-fi systems.
- **Resampling**: Manage audio resampling configurations for compatibility and optimization.

### Diagnostic Features (`audio_testing`)
- **Hardware Analysis**: Display detailed hardware configurations for ALSA DACs and Bluetooth devices.
- **Policy and System Logs**: Retrieve audio policy details and analyze logs from `dmesg` and `dumpsys`.
- **Bluetooth Debugging**: Extract and filter Bluetooth-specific audio details for troubleshooting.

---

## Usage Instructions

### Prerequisites
1. **Root Access**: Most scripts require root privileges to access and modify system-level settings.
2. **Executable Permissions**: Ensure all scripts have executable permissions:
   ```sh
   chmod +x *.sh
   ```
3. **Terminal Emulator or ADB**: Install a terminal emulator on your Android device or use ADB

### Running the Main Testing Script

```sh
sudo sh /path/to/audio_testing/audioTestlib.sh [options]
```  
If no options are specified, the script defaults to running all scripts. Check README.md in audio_testing directory for more information.

### Running a Configuration Script
```sh
su -c /path/to/config_scripts/<script_name>.sh
```   
Check README.md in the config_scripts directory for more information.

### Example Scenarios
- **Optimize USB Audio Period Settings**: Run `change-usb-period.sh` to adjust the USB audio period settings to improve performance and reduce latency during playback.
- **Gather ALSA DAC Configuration**: Run `change-usb-period.sh`  to view hardware and software configurations for ALSA DACs.
- **Reduce Latency**: Run `reduce_jitter.sh` to minimize jitter, which may be helpful during audio playback for latency-sensitive applications.
- **Analyze Audio Policy Configuration**: Run `audio-conf-src.sh` to retrieve and verify audio policy details.
- **Restore Jitter Defaults**: To restore the audio jitter settings back to their default, simply run `jitterrestore.sh`.
- **Run All Tests**: Run `audioTestlib.sh` with the -A option to execute all diagnostic scripts.


## Troubleshooting
- **Permission Denied**: If you encounter "permission denied" errors, ensure that you have root access and that the scripts have executable permissions (`chmod +x script_name.sh`).
- **Unexpected Behavior**: Review the log files generated by the scripts for insights into potential problems.

## Contributing
Feel free to contribute to this project by adding more scripts or enhancing existing functionality. Please ensure all contributions are well-documented and thoroughly tested.

## License
This project is licensed under the MIT License. Feel free to modify and use it according to your needs.

## Contact
For questions or support, please reach out to github.com/JLukassen.
